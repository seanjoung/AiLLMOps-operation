# 인프라 정기점검 항목 설정 (30가지)
# OS 10개, Kubernetes 10개, K8s Services 10개

check_items:
  # ===== OS 점검 항목 (10가지) =====
  os:
    - id: OS-001
      name: "디스크 사용량"
      description: "루트 파일시스템 디스크 사용률 확인"
      command: "df -h / | awk 'NR==2{gsub(/%/,\"\",$5); print $5}'"
      threshold: 80
      unit: "%"
      
    - id: OS-002
      name: "메모리 사용량"
      description: "시스템 메모리 사용률 확인"
      command: "free -m | awk 'NR==2{printf \"%.1f\", $3*100/$2}'"
      threshold: 85
      unit: "%"
      
    - id: OS-003
      name: "CPU 사용량"
      description: "CPU 평균 사용률 확인"
      command: "top -bn1 | grep 'Cpu(s)' | awk '{print $2}' | cut -d'.' -f1"
      threshold: 90
      unit: "%"
      
    - id: OS-004
      name: "시스템 업타임"
      description: "시스템 가동 시간 확인"
      command: "uptime -p"
      threshold: null
      unit: ""
      
    - id: OS-005
      name: "좀비 프로세스"
      description: "좀비 프로세스 개수 확인"
      command: "ps aux 2>/dev/null | awk '$8==\"Z\"' | wc -l"
      threshold: 0
      unit: "개"
      
    - id: OS-006
      name: "로드 애버리지"
      description: "시스템 로드 애버리지 (1분)"
      command: "cat /proc/loadavg | awk '{print $1}'"
      threshold: 4.0
      unit: ""
      
    - id: OS-007
      name: "Swap 사용량"
      description: "Swap 메모리 사용률 확인"
      command: "free -m | awk 'NR==3{if($2>0) printf \"%.1f\", $3*100/$2; else print \"0\"}'"
      threshold: 50
      unit: "%"
      
    - id: OS-008
      name: "열린 파일 수"
      description: "시스템 전체 열린 파일 디스크립터 수"
      command: "cat /proc/sys/fs/file-nr | awk '{print $1}'"
      threshold: 50000
      unit: "개"

    - id: OS-009
      name: "네트워크 연결 수"
      description: "ESTABLISHED 상태 TCP 연결 수"
      command: "ss -t state established 2>/dev/null | wc -l"
      threshold: 1000
      unit: "개"
      
    - id: OS-010
      name: "커널 버전"
      description: "현재 커널 버전 정보"
      command: "uname -r"
      threshold: null
      unit: ""

  # ===== Kubernetes 클러스터 점검 항목 (10가지) =====
  kubernetes:
    - id: K8S-001
      name: "노드 상태"
      description: "모든 노드의 Ready 상태 확인"
      command: "kubectl get nodes --no-headers 2>/dev/null | awk '{print $1\":\"$2}' || echo 'N/A'"
      expected: "Ready"
      
    - id: K8S-002
      name: "노드 CPU 사용량"
      description: "노드별 CPU 사용률"
      command: "kubectl top nodes --no-headers 2>/dev/null | awk '{print $1\":\"$3}' || echo 'N/A'"
      threshold: 80
      unit: "%"
      
    - id: K8S-003
      name: "노드 메모리 사용량"
      description: "노드별 메모리 사용률"
      command: "kubectl top nodes --no-headers 2>/dev/null | awk '{print $1\":\"$5}' || echo 'N/A'"
      threshold: 80
      unit: "%"
      
    - id: K8S-004
      name: "kube-system Pod 상태"
      description: "kube-system 네임스페이스 Pod 상태"
      command: "kubectl get pods -n kube-system --no-headers 2>/dev/null | awk '{print $1\":\"$3}' || echo 'N/A'"
      expected: "Running"
      
    - id: K8S-005
      name: "PV 상태"
      description: "PersistentVolume 바인딩 상태"
      command: "kubectl get pv --no-headers 2>/dev/null | awk '{print $1\":\"$5}' || echo 'N/A'"
      expected: "Bound"
      
    - id: K8S-006
      name: "PVC 상태"
      description: "PersistentVolumeClaim 바인딩 상태"
      command: "kubectl get pvc --all-namespaces --no-headers 2>/dev/null | awk '{print $2\":\"$3}' || echo 'N/A'"
      expected: "Bound"
      
    - id: K8S-007
      name: "클러스터 Warning 이벤트"
      description: "최근 1시간 Warning 이벤트 수"
      command: "kubectl get events --all-namespaces --field-selector type=Warning 2>/dev/null | wc -l || echo '0'"
      threshold: 10
      unit: "개"
      
    - id: K8S-008
      name: "NotReady 노드 수"
      description: "NotReady 상태 노드 개수"
      command: "kubectl get nodes 2>/dev/null | grep -c NotReady || echo '0'"
      threshold: 0
      unit: "개"
      
    - id: K8S-009
      name: "클러스터 버전"
      description: "Kubernetes 클러스터 버전"
      command: "kubectl version --short 2>/dev/null | grep Server | awk '{print $3}' || echo 'N/A'"
      threshold: null
      unit: ""
      
    - id: K8S-010
      name: "네임스페이스 수"
      description: "전체 네임스페이스 개수"
      command: "kubectl get namespaces --no-headers 2>/dev/null | wc -l || echo '0'"
      threshold: null
      unit: "개"

  # ===== K8s 서비스 점검 항목 (10가지) =====
  services:
    - id: SVC-001
      name: "Deployment 상태"
      description: "모든 Deployment의 Ready 상태"
      command: "kubectl get deployments --all-namespaces --no-headers 2>/dev/null | awk '{print $2\":\"$3\"/\"$4}' || echo 'N/A'"
      check_type: "replica_match"
      
    - id: SVC-002
      name: "StatefulSet 상태"
      description: "모든 StatefulSet의 Ready 상태"
      command: "kubectl get statefulsets --all-namespaces --no-headers 2>/dev/null | awk '{print $2\":\"$3}' || echo 'N/A'"
      check_type: "replica_match"
      
    - id: SVC-003
      name: "DaemonSet 상태"
      description: "모든 DaemonSet의 Ready 상태"
      command: "kubectl get daemonsets --all-namespaces --no-headers 2>/dev/null | awk '{print $2\":\"$4\"/\"$3}' || echo 'N/A'"
      check_type: "replica_match"
      
    - id: SVC-004
      name: "Service Endpoints"
      description: "Endpoint가 없는 Service 확인"
      command: "kubectl get endpoints --all-namespaces --no-headers 2>/dev/null | awk '$3==\"<none>\"{print $2}' | wc -l || echo '0'"
      threshold: 0
      unit: "개"
      
    - id: SVC-005
      name: "Ingress 상태"
      description: "Ingress 리소스 개수"
      command: "kubectl get ingress --all-namespaces --no-headers 2>/dev/null | wc -l || echo '0'"
      threshold: null
      unit: "개"
      
    - id: SVC-006
      name: "Pod 재시작 횟수 (높음)"
      description: "재시작 5회 이상 Pod 수"
      command: "kubectl get pods --all-namespaces --no-headers 2>/dev/null | awk '$5>=5{count++}END{print count+0}' || echo '0'"
      threshold: 0
      unit: "개"
      
    - id: SVC-007
      name: "Pending Pod 수"
      description: "Pending 상태 Pod 개수"
      command: "kubectl get pods --all-namespaces --field-selector=status.phase=Pending 2>/dev/null | wc -l || echo '0'"
      threshold: 0
      unit: "개"
      
    - id: SVC-008
      name: "Failed Pod 수"
      description: "Failed 상태 Pod 개수"
      command: "kubectl get pods --all-namespaces --field-selector=status.phase=Failed 2>/dev/null | wc -l || echo '0'"
      threshold: 0
      unit: "개"
      
    - id: SVC-009
      name: "CronJob 상태"
      description: "전체 CronJob 개수"
      command: "kubectl get cronjobs --all-namespaces --no-headers 2>/dev/null | wc -l || echo '0'"
      threshold: null
      unit: "개"
      
    - id: SVC-010
      name: "Job 실패 수"
      description: "Failed 상태 Job 개수"
      command: "kubectl get jobs --all-namespaces --no-headers 2>/dev/null | awk '$3==0 && $4>0{count++}END{print count+0}' || echo '0'"
      threshold: 0
      unit: "개"

# 알림 설정
notifications:
  email:
    enabled: false
    smtp_server: "smtp.example.com"
    smtp_port: 587
    sender: "infra-check@example.com"
    recipients:
      - "admin@example.com"
    use_tls: true
    
  slack:
    enabled: false
    webhook_url: ""
    channel: "#infra-alerts"
    
  teams:
    enabled: false
    webhook_url: ""
    
  discord:
    enabled: false
    webhook_url: ""

# 보고서 설정
report:
  type: "weekly"
  output_formats:
    - csv
    - docx
  output_dir: "./output"
  company_name: "Your Company"
  team_name: "Infrastructure Team"
